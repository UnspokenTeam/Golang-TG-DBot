services:
  dbmate:
    build:
      context: .
      dockerfile: Dockerfile.migrate
    container_name: tg-dbot-migrator
    volumes:
      - ../../internal/db/migrations:/db/migrations:ro
    environment:
      DATABASE_URL: "postgres://${POSTGRES_PGUSER}:${POSTGRES_PGPASS}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_PGDB}?sslmode=disable"
    depends_on:
      postgres-db:
        condition: service_healthy
    command: up
    networks:
      - tg-dbot-network
